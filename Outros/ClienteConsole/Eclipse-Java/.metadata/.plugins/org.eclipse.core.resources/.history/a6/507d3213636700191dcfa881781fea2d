package clientews;

import java.io.*; //BufferedReader, InputStreamReader
import java.net.*; //url, httpurlconnection
import java.nio.charset.StandardCharsets;

import com.google.gson.Gson; //to Json

import aluno.Aluno;

public class ClienteWS
{
	public static String chamarMetodoServidor(String url, String tipoMetodo, Object... arguments) throws IOException
    {
        //URL
        URL objURL = new URL(url);
        HttpURLConnection con = (HttpURLConnection) objURL.openConnection();
        con.setDoOutput(true);

        //conexao com WebService
        con.setRequestMethod(tipoMetodo);
        con.setRequestProperty("Content-Type", "application/json");
        
        //Passar objetos como parametros para o WebService
        if (arguments.length > 0)
        {
        	OutputStream os = con.getOutputStream();
            for (Object arg : arguments)
            {
                //Formata em json o item da lista a ser inserido com POST
                String jsonFromObj = new Gson().toJson(arg);
                System.out.println(jsonFromObj);

                //Escreve o output tranformado em Bytes
                os.write(jsonFromObj.getBytes());
            }
        }

        //response code
        int responseCode = con.getResponseCode();

        //retorno do metodo
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(con.getInputStream()));
        String inputLine;
        StringBuffer response = new StringBuffer();
        while((inputLine = bufferedReader.readLine()) != null)
            response.append(inputLine);
        String jsonReturn = response.toString(); // retorno em JSON

        bufferedReader.close();
        con.disconnect();
        
        return jsonReturn;
    }

	public static String encodeString(String str) throws UnsupportedEncodingException
	{
		return URLEncoder.encode(str, StandardCharsets.UTF_8.name());
	}
	
	public static String a() throws Exception
    {
        //URL
        URL objURL = new URL("http://localhost:8080/Escola/webresources/escola/incluirAluno");
        HttpURLConnection con = (HttpURLConnection) objURL.openConnection();
        con.setDoOutput(true);

        //conexao com WebService
        con.setRequestMethod("POST");
        con.setRequestProperty("Content-Type", "application/json");
    	
        //Formata em json o item da lista a ser inserido com POST
        String jsonFromObj = new Gson().toJson(new Aluno("17188", "Luca Dillenburg", "email"));
        System.out.println(jsonFromObj);

        //Escreve o output tranformado em Bytes
        /* OutputStream os = con.getOutputStream();
        os.write(jsonFromObj.getBytes());
        os.close(); */
        OutputStreamWriter out = new OutputStreamWriter(con.getOutputStream());
        out.write(jsonFromObj);
        out.close();

        //response code
        int responseCode = con.getResponseCode();

        //retorno do metodo
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(con.getInputStream()));
        String inputLine;
        StringBuffer response = new StringBuffer();
        while((inputLine = bufferedReader.readLine()) != null)
            response.append(inputLine);
        String jsonReturn = response.toString(); // retorno em JSON

        bufferedReader.close();
        con.disconnect();
        
        return jsonReturn;
    }

}
